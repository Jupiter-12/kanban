# 项目宪章 - 看板系统

## 项目概述

| 项目 | 内容 |
|------|------|
| **项目名称** | 看板系统 |
| **核心价值** | 让工作可见——通过可视化方式跟踪项目进度 |
| **目标用户** | 50人小团队 |
| **核心场景** | 任务管理、进度跟踪、团队协作 |
| **产品形态** | Web端（私有化部署） |

## 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端框架** | Vue 3 + TypeScript | 组件化开发，类型安全 |
| **UI组件库** | Element Plus | 企业级组件库 |
| **后端框架** | Python + FastAPI | 简洁高效，异步支持 |
| **数据库** | SQLite | 单文件，零配置，便于备份迁移 |
| **部署方式** | 直接运行 | uvicorn启动，无需容器化 |

## 核心原则

### 简单优先
- 功能够用即可，不过度设计
- 避免引入不必要的复杂度
- 优先选择成熟稳定的方案

### 单体架构
- 不拆分微服务，降低运维复杂度
- 前后端可分离部署，但保持简单
- 渐进式演进，按需扩展

### 最小依赖
- 减少外部中间件依赖
- 不使用Redis、消息队列等中间件
- 实时同步采用轮询方式（5-10秒刷新）

### 渐进迭代
- MVP先上线，后续按需扩展
- 优先保证核心功能稳定
- 根据用户反馈持续改进

## 代码风格

### Python后端

| 项目 | 规范 |
|------|------|
| 格式化/检查工具 | Ruff |
| 变量/函数命名 | snake_case |
| 类命名 | PascalCase |
| 常量命名 | UPPER_SNAKE_CASE |
| 缩进 | 4空格 |
| 最大行宽 | 120字符 |

### Vue前端

| 项目 | 规范 |
|------|------|
| 代码检查工具 | ESLint |
| 变量/函数命名 | camelCase |
| 组件命名 | PascalCase |
| 常量命名 | UPPER_SNAKE_CASE |
| 缩进 | 2空格 |
| 最大行宽 | 120字符 |

## 注释规范

### 何时添加注释
- 所有公开函数/类必须添加注释
- 复杂逻辑必须添加注释
- 关键业务规则必须添加注释
- 非显而易见的代码必须添加注释

### 注释风格

**Python（Google风格docstring）：**
```python
def create_task(title: str, assignee_id: int) -> Task:
    """创建新任务。

    Args:
        title: 任务标题，不能为空
        assignee_id: 负责人ID

    Returns:
        创建成功的任务对象

    Raises:
        ValueError: 当标题为空时抛出
    """
```

**Vue/TypeScript（JSDoc风格）：**
```typescript
/**
 * 创建新任务
 * @param title - 任务标题，不能为空
 * @param assigneeId - 负责人ID
 * @returns 创建成功的任务对象
 * @throws 当标题为空时抛出错误
 */
```

### 注释语言
- 所有注释使用中文
- 报错信息使用中文

## 测试策略

### 测试类型

| 测试类型 | 要求 | 工具 |
|----------|------|------|
| 单元测试 | 核心业务逻辑必须覆盖 | pytest |
| 接口测试 | API接口必须覆盖 | pytest + httpx |
| E2E测试 | 关键流程覆盖 | vitest + playwright |

### 测试原则
- 测试代码与业务代码同等重要
- 优先测试核心业务逻辑
- 测试用例应该清晰、独立、可重复

### 测试覆盖要求
- 核心业务逻辑：≥80%
- API接口：100%
- 关键用户流程：100%

## Git工作流

### 分支策略
- `main`：主分支，保持稳定可发布状态
- `develop`：开发分支，日常开发合并到此
- `feature/*`：功能分支，从develop创建
- `bugfix/*`：修复分支，从develop创建
- `release/*`：发布分支，从develop创建

### 提交规范
提交信息格式：`<type>: <description>`

| 类型 | 说明 |
|------|------|
| feat | 新功能 |
| fix | 修复bug |
| docs | 文档更新 |
| style | 代码格式调整 |
| refactor | 重构 |
| test | 测试相关 |
| chore | 构建/工具相关 |

示例：
- `feat: 添加任务拖拽功能`
- `fix: 修复任务状态更新失败问题`

## 架构约束

### 目录结构
```
kanban/
├── backend/                 # 后端代码
│   ├── app/
│   │   ├── api/            # API路由
│   │   ├── models/         # 数据模型
│   │   ├── services/       # 业务逻辑
│   │   ├── schemas/        # Pydantic模型
│   │   └── utils/          # 工具函数
│   ├── tests/              # 测试代码
│   └── main.py             # 入口文件
├── frontend/               # 前端代码
│   ├── src/
│   │   ├── api/            # API调用
│   │   ├── components/     # 组件
│   │   ├── views/          # 页面
│   │   ├── stores/         # 状态管理
│   │   └── utils/          # 工具函数
│   └── tests/              # 测试代码
├── scripts/                # 快捷脚本
├── openspec/               # 规范文档
└── data/                   # SQLite数据文件
```

### 分层原则
- API层：处理HTTP请求/响应，参数校验
- Service层：业务逻辑，事务处理
- Model层：数据访问，ORM映射

### 依赖方向
- API → Service → Model
- 禁止反向依赖
- 禁止跨层调用

## 前端布局规范

### 目标平台
- **仅支持桌面端**，不需要考虑移动端适配

### 布局要求

| 项目 | 规范 |
|------|------|
| **布局方式** | 响应式 + 流式布局 |
| **滚动条** | 特殊情况下启用垂直和水平滚动条 |
| **最小宽度** | 根据内容需要设定合理的最小宽度 |

### 布局原则
- 优先使用响应式布局，适应不同桌面分辨率
- 采用流式布局，内容随容器宽度自适应
- 仅在内容超出视口时显示滚动条
- 避免固定宽度，优先使用百分比或弹性布局

## 安全约束

### 认证授权
- 使用JWT进行身份认证
- 密码使用bcrypt加密存储
- 敏感操作需要权限校验

### 数据安全
- 所有API必须进行参数校验
- 防止SQL注入（使用ORM）
- 防止XSS攻击（前端转义）
- 操作日志完整记录

### 部署安全
- 生产环境必须使用HTTPS
- 敏感配置使用环境变量
- 定期备份数据库文件

## 性能目标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 页面加载 | < 3秒 | P95，100张卡片看板 |
| API响应 | < 500ms | P95，常规操作 |
| 并发支持 | 50用户 | 同时在线操作 |
| 数据刷新 | 5-10秒 | 轮询间隔 |

## 外部依赖

### 后端依赖
- FastAPI：Web框架
- SQLAlchemy：ORM
- Pydantic：数据校验
- python-jose：JWT处理
- bcrypt：密码加密

### 前端依赖
- Vue 3：前端框架
- Element Plus：UI组件库
- Pinia：状态管理
- Axios：HTTP客户端
- Vue Router：路由管理

## 重要约束

### 禁止事项
- 禁止引入Redis、消息队列等中间件
- 禁止使用Docker部署
- 禁止拆分微服务
- 禁止过度抽象和设计模式滥用

### 必须遵守
- 所有代码必须有类型注解
- 所有公开API必须有文档
- 所有变更必须经过代码审查
- 所有功能必须有对应测试
